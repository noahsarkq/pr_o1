<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="referrer" content="no-referrer">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdn.plyr.io/3.6.2/plyr.css" />
    <script "text/javascript" src="https://cdn.plyr.io/3.6.3/plyr.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Poppins|Quattrocento+Sans" rel="stylesheet"/>
    <script "text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dashjs/3.1.3/dash.all.min.js"></script>
    <!-- <script "text/javascript" src="https://cdn.jsdelivr.net/npm/hls.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <title id="arkx">Brightcove Viewer</title>
    <style>
        #bcd{
            text-align: center;
            font-size: 20px;
            

        }
        #pr1{
            font-size:25px;
        }
        #dr{
            color: crimson;
            font-size:40px;
        }
        
  
    </style>
</head>
<body>
    <div id="asxet">

    </div>
    <div id="bcd">
    <form action="/bcove" id="bright" >
   
    <input type="text" name="id" id="bco" placeholder="BrightcoveID" required>
    <button>Play</button>
    
    </form>
    <p id='para'> <br >
    <span id="pr1">  To play first Edit Html with any editor and add your accountid and policykey</span>  </br>
    <br><span id="dr">  For DRM use Firefox or Host Html to Local or git anywhre</span></br>


    </p>
    </div>
    <script>
        const accountid=6206459123001; // Enter account id 
        const policykey="BCpkADawqM1474MvKwYlMRZNBPoqkJY-UWm7zE1U769d5r5kqTjG0v8L-THXuVZtdIQJpfMPB37L_VJQxTKeNeLO2Eac_yMywEgyV9GjFDQ2LTiT4FEiHhKAUvdbx9ku6fGnQKSMB8J5uIDd"; //Enter Policy key
        const st0= document.querySelector("#bright");
        st0.addEventListener('submit',async function(e){
            e.preventDefault();
            const bcid=document.querySelector('input').value;
            // console.log(bcid)
            if (bcid.match(/^([0-9]){13,}$/)) {
                const jso =  await bcv(bcid);
            await creat(jso);
    
}
            

        });


        async function bcv(bcid){
            const config={headers:{"BCOV-Policy": policykey,"Content-Type":"application/json"}};
            const res = await axios.get(`https://edge.api.brightcove.com/playback/v1/accounts/${accountid}/videos/${bcid}`,config);
            return (res.data);           
            
        }
        async function creat(deta){
            url=deta.sources[3].src;
            console.log(deta.name);
            document.getElementById("arkx").innerText=deta.name;

            if ("key_systems" in deta.sources[3]){
                    var widevine_url = deta.sources[3]["key_systems"]["com.widevine.alpha"]["license_url"];
                    var microsoft_url = deta.sources[3]["key_systems"]["com.microsoft.playready"]["license_url"];                
        
                };
            // document.getElementById('bright').remove();
            var x = document.createElement("video");
            x.id = "videoContainer";
            x.style = "background-color: #000000;";
            
           
            var y = document.createElement("source");
            
            y.src= url;
            x.appendChild(y);
            document.getElementById("asxet").appendChild(x);
            const video = document.getElementById("videoContainer");
            const source = url;
            const dash = dashjs.MediaPlayer().create();
            const controls = [
              'play-large', // The large play button in the center
              //'restart', // Restart playback
              'rewind', // Rewind by the seek time (default 10 seconds)
              'play', // Play/pause playback
              'fast-forward', // Fast forward by the seek time (default 10 seconds)
              'progress', // The progress bar and scrubber for playback and buffering
              'current-time', // The current time of playback
              'duration', // The full duration of the media
              'mute', // Toggle mute
              'volume', // Volume control
              'captions', // Toggle captions
              'settings',
              'pip', // Picture-in-picture (currently Safari only)
              //'airplay', // Airplay (currently Safari only)
              //'download', // Show a download button with a link to either the current source or a custom URL you specify in your options
              'fullscreen' // Toggle fullscreen
              ];
            var defaultOptions = {
            "autoplay": false,
            "muted": false,
            controls:controls,
            "loop": {
                "active": false
            },
            "captions": {
                "active": true,
                "update": true
            }
        };
            dash.setProtectionData({
            "com.widevine.alpha": {
                            "serverURL":  `${widevine_url}`
            },
            "com.microsoft.playready": {
                            "serverURL": `${microsoft_url}`
            }
        });
        dash.initialize(video, source, false);
            dash.updateSettings({
            streaming: {
                abr: {
                    autoSwitchBitrate: {
                        audio: false,
                        video: false
                    }
                },
                fastSwitchEnabled: true,
                lowLatencyEnabled: true
            }
        }); 
        dash.on("streamInitialized", function() {
        const availableQualities = dash.getBitrateInfoListFor("video").map((l) => l.height);
        defaultOptions.quality = {
                default: availableQualities[0].height,
                options: availableQualities,
                forced: true,
                onChange: function(newQuality) {
                    dash.getBitrateInfoListFor("video").forEach((level, levelIndex) => {
                        if (level.height === newQuality) {
                            dash.setQualityFor("video", level.qualityIndex);
                        }
                    });
                },
            };
         
            defaultOptions.tooltips = {controls: true, seek:true};
            const player = new Plyr(video, defaultOptions);
            window.player = player;
            window.dash = dash;
        });
        dash.attachView(video);     
    };

       


        
    </script>
    
</body>
</html>